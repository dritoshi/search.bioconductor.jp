<%- model_class = Code.new.class -%>

<p>
<%= form_tag codes_path, :method => :get do %>
  <%= text_field_tag :query, params[:query],  {:class => "input-xlarge", :placeholder => "Type somethingâ€¦"} %>
  <%= submit_tag "Search", :name => nil %>
<% end %>  

<% if @search == [] %>
  <div class="row">
  Results: 0
 </div>
<% else %>

<div class="row">
Results: <%= @search.hits.size %>
</div>

<p>
<% @search.hits.each do |hit| %>
  <% hit.highlights(:code).each do |highlight| %>
    <% highlight.format do |code| %>
    <% code %>
      <div class="row">
        <h2>
          <%= link_to code.file, code_path(code) %> - <%= code.file_path %><br/>
        </h2>
          Package: <%= link_to code.package, "http://bioconductor.jp/packages/2.11/bioc/html/#{code.package}.html" %> -
          Version: <%= code.version %> -
          Language: <%= code.language %>
      </div>

      <div class="row">
        <% cache do %>
          <%== Pygments.highlight(CGI.unescapeHTML(code.code)) %>
        <% end %>
      </div>
    <% end %>
  <% end %>
<% end %>

<%= will_paginate(@search.hits, :renderer => WillPaginate::ActionView::LinkRenderer) %>
<% end %>
